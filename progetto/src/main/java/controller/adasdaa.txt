 @GetMapping("/ricarica")
    public String showAddFundsForm(Model model, HttpSession session) {
        
        // Controlla se l'utente è autenticato
        User user = (User) session.getAttribute("user");
        if (user == null) {
            // Se non è loggato, reindirizza alla pagina di login
            return "redirect:/login";  // Modifica l'URL secondo le tue necessità
        }
        
        // Se l'utente è loggato, aggiungi l'attributo al modello
        model.addAttribute("user", user);
        return "dashboard/user/ricarica"; // Nome della vista JSP per aggiungere fondi
    }

    // Gestisce l'aggiunta di fondi al wallet
    @PostMapping("/ricarica")
    public String addFunds(@RequestParam double amount, HttpSession session, RedirectAttributes redirectAttributes) {
        AbstractApplicationContext context = new AnnotationConfigApplicationContext(JpaConfig.class);
        UserDAO userDAO = context.getBean(UserDAO.class);
        User user = (User) session.getAttribute("user");
        context.close();

        if (user != null) {
            user.setWallet(user.getWallet() + amount); // Aggiungi fondi al wallet

            // Salva l'utente aggiornato nel database
            userDAO.updateUser(user);

            // Aggiungi un messaggio di successo al redirect
            redirectAttributes.addFlashAttribute("successMessage", "Fondi aggiunti con successo!");
            return "redirect:/wallet"; // Reindirizza alla pagina del wallet
        } else {
            return "redirect:/login"; // Reindirizza al login se l'utente non è loggato
        }
    }

    // Pagina di conferma dopo l'aggiornamento del wallet
    @GetMapping("/ricaricaConfirmed")
    public String ricaricaConfirmed(Model model, HttpSession session) {
        User user = (User) session.getAttribute("user");

        // TODO: perchè se user!= null facciamo così? Dov'è il controllo sul login?
        if (user != null) {
            model.addAttribute("user", user);
            return "ricaricaConfirmed"; // Nome della vista JSP per il wallet aggiornato
        } else {
            return "redirect:/login"; // Reindirizza al login se non è loggato
        }
    }


    // Mostra la pagina del wallet
    @GetMapping("/wallet")
    public String showWallet(HttpServletRequest request, Model model) {
        HttpSession session = request.getSession();
        User loggedInUser = (User) session.getAttribute("user");

        if (loggedInUser == null) {
            return "redirect:/login"; // Se non è loggato, reindirizza al login
        }

        model.addAttribute("user", loggedInUser);
        return "dashboard/user/wallet"; // Mostra la dashboard
    }